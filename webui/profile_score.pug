//-
    scores with client-side pagination

//DATA//
    profile: DB.FindOne(refid, { collection: 'profile' })
    scores: DB.Find(refid, { collection: 'score'})

//- Helpers
-
    const seqLabel = (n) => (n === 0 ? 'BASIC' : n === 1 ? 'ADVANCED' : n === 2 ? 'EXTREME' : String(n))
    const modeLabel = (b) => (b ? 'HARD' : 'NORMAL')
    // 표시에 사용할 문자열
    const formatDate = (data) => {
        const date = data.updatedAt || data.createdAt
        const y = date.getFullYear()
        const m = String(date.getMonth() + 1).padStart(2, '0')
        const day = String(date.getDate()).padStart(2, '0')
        const h24 = date.getHours()
        const ap = h24 < 12 ? '오전' : '오후'
        const h12 = (h24 % 12) || 12
        const mi = String(date.getMinutes()).padStart(2, '0')
        return `${y}-${m}-${day} ${ap} ${h12}:${mi}`
    }

    /*let sortedScores = scores.slice().sort((a, b) => {
        return (b.updatedAt || b.createdAt).getTime() - (a.updatedAt || a.createdAt).getTime();
    })*/
    const newScores = {};
    for(const scoreData of scores){
        if(scoreData.isHardMode) continue;
        newScores[scoreData.musicId] ??= [];
        newScores[scoreData.musicId][scoreData.seq] = scoreData
    }

link(rel="stylesheet" href="static/css/score.css")

section.section
    .container.is-fluid
        h1.title.is-4
            | 점수
            if profile && profile.name
                span.has-text-grey-light &nbsp;•&nbsp; #{profile.name}
        .paginated-container(pagination-group="history")
            .level
                .level-left
                    .level-item
                        label(style="font-weight: bold") 항목 개수
                        input.input.page-size(type="number" min="1" value="20" style="width: 6rem; margin-left: .75rem;")
                .level-right
                    .level-item.pagination-controls(style="display:none")
                        button.button.pagination-previous 이전
                        .pagination-info(style="margin: 0 0.75rem; display: flex; align-items: center;")
                            input.input.current-page(type="text", style="width: 4rem; text-align: center;")
                            span &nbsp;/&nbsp;
                            span.total-pages
                        button.button.pagination-next 다음

            .table-container
                table.table.is-striped.is-hoverable.is-fullwidth
                    colgroup
                        col
                        col
                        col.col-score
                        col.col-score
                        col.col-score
                    thead
                        tr
                            th ID
                            th 이름
                            th(colspan="3") 점수
                            //th Rate
                    tbody
                        each data, musicId in newScores
                            tr.paginated-content(data-music-id=musicId)
                                td= musicId
                                td.song-name
                                td.cell-bsc= data[0] ? data[0].score.toLocaleString('ko-KR') : '-'
                                td.cell-adv= data[1] ? data[1].score.toLocaleString('ko-KR') : '-'
                                td.cell-ext= data[2] ? data[2].score.toLocaleString('ko-KR') : '-'
                                //td= (s.musicRate / 10) + '%'
            // 하단 페이지네이션 바
            .pagination-controls.is-flex.is-justify-content-center(style="margin-top: 1.5rem; display:none;")
                button.button.pagination-previous 이전
                .pagination-info(style="margin: 0 0.75rem; display: flex; align-items: center;")
                    input.input.current-page(type="text", style="width: 4rem; text-align: center;")
                    span &nbsp;/&nbsp;
                    span.total-pages
                button.button.pagination-next 다음

script(src = "static/js/score.js")